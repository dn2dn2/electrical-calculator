<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√îNG C·ª§ T√çNH TO√ÅN</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.3em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
        }

        input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 10px;
        }

        button:hover {
            transform: scale(1.02);
        }

        button:active {
            transform: scale(0.98);
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            background: #f0f4ff;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .result-value {
            font-size: 1.5em;
            color: #667eea;
            font-weight: bold;
        }

        .result-label {
            color: #666;
            margin-bottom: 5px;
        }

        .formula {
            font-size: 0.85em;
            color: #888;
            margin-top: 5px;
            font-style: italic;
        }

        .input-params {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .input-params h2 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }

        .params-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .phase-selector {
            grid-column: 1 / -1;
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-radius: 10px;
        }

        .phase-option {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .phase-option input[type="radio"] {
            width: auto;
            cursor: pointer;
            transform: scale(1.5);
        }

        .phase-option label {
            margin: 0;
            cursor: pointer;
            font-size: 1.1em;
        }

        .phase-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }

        .badge-1phase {
            background: #3498db;
            color: white;
        }

        .badge-3phase {
            background: #e74c3c;
            color: white;
        }

        .auto-calc-button {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%) !important;
            margin-top: 20px;
            font-size: 1.2em !important;
        }
        
        /* === CSS M·ªöI CHO N√öT RESET === */
        .reset-button {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%) !important;
            margin-top: 10px;
        }
        
        .auto-update-wrapper {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            background: #f0f4ff;
            border-radius: 8px;
        }

        .auto-update-wrapper input[type="checkbox"] {
             width: auto;
             transform: scale(1.2);
             margin-right: 10px;
             cursor: pointer;
        }

        .auto-update-wrapper label {
            display: inline-block;
            color: #333;
            font-weight: 600;
            cursor: pointer;
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ö° C√îNG C·ª§ T√çNH TO√ÅN ƒêI·ªÜN</h1>

        <div class="input-params">
            <h2>Th√¥ng S·ªë ƒê·∫ßu V√†o</h2>
            
            <div class="phase-selector">
                <div class="phase-option">
                    <input type="radio" id="phase1" name="phase" value="1">
                    <label for="phase1">üîµ M·∫°ng 1 Pha</label>
                </div>
                <div class="phase-option">
                    <input type="radio" id="phase3" name="phase" value="3" checked>
                    <label for="phase3">üî¥ M·∫°ng 3 Pha</label>
                </div>
            </div>

            <div class="params-grid">
                <div class="input-group">
                    <label>ƒêi·ªán √°p V</label>
                    <input type="number" id="voltage" step="0.01" placeholder="220V (1 pha) ho·∫∑c 380V (3 pha)">
                </div>
                <div class="input-group">
                    <label>D√≤ng ƒëi·ªán I (A)</label>
                    <input type="number" id="current" step="0.01" placeholder="Nh·∫≠p d√≤ng ƒëi·ªán">
                </div>
                <div class="input-group">
                    <label>C√¥ng su·∫•t kW</label>
                    <input type="number" id="kw" step="0.01" placeholder="Nh·∫≠p kW">
                </div>
                <div class="input-group">
                    <label>C√¥ng su·∫•t kVA</label>
                    <input type="number" id="kva" step="0.01" placeholder="Nh·∫≠p kVA">
                </div>
                <div class="input-group">
                    <label>C√¥ng su·∫•t kVAR</label>
                    <input type="number" id="kvar" step="0.01" placeholder="Nh·∫≠p kVAR">
                </div>
                <div class="input-group">
                    <label>C√¥ng su·∫•t HP</label>
                    <input type="number" id="hp" step="0.01" placeholder="Nh·∫≠p HP">
                </div>
                <div class="input-group">
                    <label>H·ªá s·ªë c√¥ng su·∫•t (Cos œÜ - pF)</label>
                    <input type="number" id="pf" step="0.01" min="0" max="1" placeholder="0.8 - 1.0">
                </div>
                <div class="input-group">
                    <label>Hi·ªáu su·∫•t Eff (%)</label>
                    <input type="number" id="eff" step="0.01" min="0" max="100" placeholder="80 - 95">
                </div>
            </div>

            <button onclick="autoCalculateAll()" class="auto-calc-button">
                T√çNH TO√ÅN T·∫§T C·∫¢
            </button>
            
            <button onclick="resetAllInputs()" class="reset-button">
                X√≥a t·∫•t c·∫£ th√¥ng s·ªë
            </button>

            <div class="auto-update-wrapper">
                <input type="checkbox" id="autoUpdate">
                <label for="autoUpdate">T·ª± ƒë·ªông c·∫≠p nh·∫≠t khi thay ƒë·ªïi th√¥ng s·ªë</label>
            </div>
        </div>

        <div class="calculator-grid">
            <div class="card">
                <h2>T√≠nh Amperes (A)</h2>
                <button onclick="calcAFromKVA()">A t·ª´ kVA, V <span id="badge-a-kva" class="phase-badge badge-1phase">1 Pha</span></button>
                <div id="result-a-kva" class="result" style="display:none;">
                    <div class="result-label">K·∫øt qu·∫£:</div>
                    <div class="result-value"></div>
                    <div class="formula"></div>
                </div>

                <button onclick="calcAFromKW()">A t·ª´ kW, V, pF <span id="badge-a-kw" class="phase-badge badge-1phase">1 Pha</span></button>
                <div id="result-a-kw" class="result" style="display:none;">
                    <div class="result-label">K·∫øt qu·∫£:</div>
                    <div class="result-value"></div>
                    <div class="formula"></div>
                </div>

                <button onclick="calcAFromHP()">A t·ª´ HP, V, Eff, pF <span id="badge-a-hp" class="phase-badge badge-1phase">1 Pha</span></button>
                <div id="result-a-hp" class="result" style="display:none;">
                    <div class="result-label">K·∫øt qu·∫£:</div>
                    <div class="result-value"></div>
                    <div class="formula"></div>
                </div>

                <button onclick="calcAFromKVAR()">A t·ª´ kVAR, V <span id="badge-a-kvar" class="phase-badge badge-1phase">1 Pha</span></button>
                <div id="result-a-kvar" class="result" style="display:none;">
                    <div class="result-label">K·∫øt qu·∫£:</div>
                    <div class="result-value"></div>
                    <div class="formula"></div>
                </div>
            </div>
			<div class="card">
                <h2>T√≠nh kW (Kilowatts)</h2>
                <button onclick="calcKwFromIVpF()">kW t·ª´ I, V, pF <span id="badge-kw-ivpf" class="phase-badge badge-1phase">1 Pha</span></button>
                <div id="result-kw-ivpf" class="result" style="display:none;">
                    <div class="result-label">K·∫øt qu·∫£:</div>
                    <div class="result-value"></div>
                    <div class="formula"></div>
                </div>

                <button onclick="calcKwFromKVApF()">kW t·ª´ kVA, pF<span id="badge-kw-kvapf" class="phase-badge badge-1phase">1 Pha</span></button>
                <div id="result-kw-kvapf" class="result" style="display:none;">
                    <div class="result-label">K·∫øt qu·∫£:</div>
                    <div class="result-value"></div>
                    <div class="formula">kW = kVA √ó pF</div>
                </div>

                <button onclick="calcKwFromHPEff()">kW t·ª´ HP, Eff<span id="badge-kw-hpeff" class="phase-badge badge-1phase">1 Pha</span></button>
                <div id="result-kw-hpeff" class="result" style="display:none;">
                    <div class="result-label">K·∫øt qu·∫£:</div>
                    <div class="result-value"></div>
                    <div class="formula">kW = (HP √ó 0.746) / (Eff/100)</div>
                </div>
            </div>
			
            <div class="card">
                <h2>T√≠nh kVA (Kilovolt-Amperes)</h2>
                <button onclick="calcKVAFromIV()">kVA t·ª´ I, V <span id="badge-kva-iv" class="phase-badge badge-1phase">1 Pha</span></button>
                <div id="result-kva-iv" class="result" style="display:none;">
                    <div class="result-label">K·∫øt qu·∫£:</div>
                    <div class="result-value"></div>
                    <div class="formula"></div>
                </div>

                <button onclick="calcKVAFromKWpF()">kVA t·ª´ kW, pF<span id="badge-kva-kwpf" class="phase-badge badge-1phase">1 Pha</span></button>
                <div id="result-kva-kwpf" class="result" style="display:none;">
                    <div class="result-label">K·∫øt qu·∫£:</div>
                    <div class="result-value"></div>
                    <div class="formula">kVA = kW / pF</div>
                </div>

                <button onclick="calcKVAFromHPEffpF()">kVA t·ª´ HP, Eff, pF<span id="badge-kva-hpeffpf" class="phase-badge badge-1phase">1 Pha</span></button>
                <div id="result-kva-hpeffpf" class="result" style="display:none;">
                    <div class="result-label">K·∫øt qu·∫£:</div>
                    <div class="result-value"></div>
                    <div class="formula">kVA = (HP √ó 0.746) / (Eff/100 √ó pF)</div>
                </div>
            </div>
			<div class="card">
                <h2>T√≠nh kVAR (Reactive Power)</h2>
                <button onclick="calcKVARFromKWKVA()">kVAR t·ª´ kW, kVA<span id="badge-kvar-kwkva" class="phase-badge badge-1phase">1 Pha</span></button>
                <div id="result-kvar-kwkva" class="result" style="display:none;">
                    <div class="result-label">K·∫øt qu·∫£:</div>
                    <div class="result-value"></div>
                    <div class="formula">kVAR = ‚àö(kVA¬≤ - kW¬≤)</div>
                </div>
            </div>
            <div class="card">
                <h2>T√≠nh HP (Horsepower)</h2>
                <button onclick="calcHPFromIVEffpF()">HP t·ª´ I, V, Eff, pF <span id="badge-hp-iveffpf" class="phase-badge badge-1phase">1 Pha</span></button>
                <div id="result-hp-iveffpf" class="result" style="display:none;">
                    <div class="result-label">K·∫øt qu·∫£:</div>
                    <div class="result-value"></div>
                    <div class="formula"></div>
                </div>

                <button onclick="calcHPFromKVAEffpF()">HP t·ª´ kVA, Eff, pF <span id="badge-hp-kvaeffpf" class="phase-badge badge-1phase">1 Pha</span></button>
                <div id="result-hp-kvaeffpf" class="result" style="display:none;">
                    <div class="result-label">K·∫øt qu·∫£:</div>
                    <div class="result-value"></div>
                    <div class="formula"></div>
                </div>
            </div>
            
        </div>
    </div>

    <script>
        // === H√ÄM M·ªöI: ƒê·ªãnh nghƒ©a c√°c ID input ƒë·ªÉ d·ªÖ d√†ng qu·∫£n l√Ω ===
        const inputIds = ['voltage', 'current', 'kw', 'kva', 'kvar', 'hp', 'pf', 'eff'];

        // C·∫≠p nh·∫≠t badges khi thay ƒë·ªïi lo·∫°i m·∫°ng
        document.querySelectorAll('input[name="phase"]').forEach(radio => {
            radio.addEventListener('change', () => {
                updatePhaseBadges();
                if (document.getElementById('autoUpdate').checked) {
                    autoCalculateAll();
                }
                saveInputsToLocalStorage(); // === M·ªöI: L∆∞u khi ƒë·ªïi Phase ===
            });
        });

        // Th√™m s·ª± ki·ªán cho t·∫•t c·∫£ c√°c input ƒë·ªÉ t·ª± ƒë·ªông t√≠nh to√°n
        document.querySelectorAll('.params-grid input[type="number"]').forEach(input => {
            input.addEventListener('input', () => {
                if (document.getElementById('autoUpdate').checked) {
                    autoCalculateAll();
                }
                saveInputsToLocalStorage(); // === M·ªöI: L∆∞u khi nh·∫≠p li·ªáu ===
            });
        });

        function updatePhaseBadges() {
            const phase = getPhase();
            const badges = document.querySelectorAll('.phase-badge');
            badges.forEach(badge => {
                if (phase === 3) {
                    badge.textContent = '3 Pha';
                    badge.className = 'phase-badge badge-3phase';
                } else {
                    badge.textContent = '1 Pha';
                    badge.className = 'phase-badge badge-1phase';
                }
            });
            const voltageInput = document.getElementById('voltage');
            if (phase === 3) {
                voltageInput.placeholder = "380V";
            } else {
                voltageInput.placeholder = "220V";
            }
        }

        function getPhase() {
            return parseInt(document.querySelector('input[name="phase"]:checked').value);
        }

        function getInput(id) {
            const value = parseFloat(document.getElementById(id).value);
            return isNaN(value) ? null : value;
        }

        function showResult(elementId, value, unit, formula, silentFail = false) {
            const resultDiv = document.getElementById(elementId);
            if (value !== null && isFinite(value)) {
                resultDiv.style.display = 'block';
                resultDiv.querySelector('.result-value').textContent = value.toFixed(2) + ' ' + unit;
                if (formula) {
                    resultDiv.querySelector('.formula').textContent = formula;
                }
            } else {
                if (!silentFail) {
                    alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß v√† ch√≠nh x√°c c√°c th√¥ng s·ªë c·∫ßn thi·∫øt!');
                }
                resultDiv.style.display = 'none';
            }
        }

        function autoCalculateAll() {
            calcAFromKVA(true);
            calcAFromKW(true);
            calcAFromHP(true);
            calcAFromKVAR(true);
            calcKwFromIVpF(true);
            calcKwFromKVApF(true);
            calcKwFromHPEff(true);
            calcKVAFromIV(true);
            calcKVAFromKWpF(true);
            calcKVAFromHPEffpF(true);
            calcKVARFromKWKVA(true);
            calcHPFromIVEffpF(true);
            calcHPFromKVAEffpF(true);
        }

        // === H√ÄM M·ªöI: ·∫®n t·∫•t c·∫£ c√°c k·∫øt qu·∫£ ===
        function clearAllResults() {
            document.querySelectorAll('.result').forEach(div => {
                div.style.display = 'none';
            });
        }

        // === H√ÄM M·ªöI: Reset t·∫•t c·∫£ inputs v√† Local Storage ===
        function resetAllInputs() {
            // X√≥a gi√° tr·ªã trong c√°c √¥ input
            inputIds.forEach(id => {
                document.getElementById(id).value = '';
                localStorage.removeItem(id); // X√≥a kh·ªèi Local Storage
            });

            // Reset Phase v·ªÅ m·∫∑c ƒë·ªãnh (3 Pha) v√† x√≥a kh·ªèi Local Storage
            document.getElementById('phase3').checked = true;
            localStorage.removeItem('phase');
            
            updatePhaseBadges(); // C·∫≠p nh·∫≠t l·∫°i giao di·ªán Phase
            clearAllResults(); // ·∫®n t·∫•t c·∫£ c√°c k·∫øt qu·∫£
        }

        // === H√ÄM M·ªöI: L∆∞u t·∫•t c·∫£ gi√° tr·ªã v√†o Local Storage ===
        function saveInputsToLocalStorage() {
            inputIds.forEach(id => {
                localStorage.setItem(id, document.getElementById(id).value);
            });
            localStorage.setItem('phase', getPhase());
        }

        // === H√ÄM M·ªöI: T·∫£i gi√° tr·ªã t·ª´ Local Storage khi m·ªü trang ===
        function loadInputsFromLocalStorage() {
            // T·∫£i Phase tr∆∞·ªõc
            const savedPhase = localStorage.getItem('phase');
            if (savedPhase) {
                // ƒê·∫£m b·∫£o radio button ƒë∆∞·ª£c ch·ªçn ƒë√∫ng
                const phaseRadio = document.getElementById(savedPhase === '1' ? 'phase1' : 'phase3');
                if (phaseRadio) phaseRadio.checked = true;
            }
            // C·∫≠p nh·∫≠t badges ngay sau khi t·∫£i Phase
            updatePhaseBadges();
            
            // T·∫£i c√°c gi√° tr·ªã input kh√°c
            inputIds.forEach(id => {
                const savedValue = localStorage.getItem(id);
                if (savedValue !== null) {
                    document.getElementById(id).value = savedValue;
                }
            });

            // T·ª± ƒë·ªông t√≠nh to√°n l·∫°i d·ª±a tr√™n gi√° tr·ªã ƒë√£ t·∫£i
            autoCalculateAll();
        }

        // --- C√°c h√†m t√≠nh to√°n (Kh√¥ng thay ƒë·ªïi) ---

        function calcKwFromIVpF(silentFail = false) {
            const v = getInput('voltage');
            const i = getInput('current');
            const pf = getInput('pf');
            const phase = getPhase();
            
            if (v && i && pf) {
                let kw, formula;
                if (phase === 3) {
                    kw = (Math.sqrt(3) * v * i * pf) / 1000;
                    formula = 'kW = (‚àö3 √ó V √ó I √ó pF) / 1000';
                } else {
                    kw = (v * i * pf) / 1000;
                    formula = 'kW = (V √ó I √ó pF) / 1000';
                }
                showResult('result-kw-ivpf', kw, 'kW', formula, silentFail);
            } else {
                showResult('result-kw-ivpf', null, null, null, silentFail);
            }
        }

        function calcKwFromKVApF(silentFail = false) {
            const kva = getInput('kva');
            const pf = getInput('pf');
            if (kva && pf) {
                const kw = kva * pf;
                showResult('result-kw-kvapf', kw, 'kW', null, silentFail);
            } else {
                showResult('result-kw-kvapf', null, null, null, silentFail);
            }
        }

        function calcKwFromHPEff(silentFail = false) {
            const hp = getInput('hp');
            const eff = getInput('eff');
            if (hp && eff) {
                const kw = (hp * 0.746) / (eff / 100);
                showResult('result-kw-hpeff', kw, 'kW', null, silentFail);
            } else {
                showResult('result-kw-hpeff', null, null, null, silentFail);
            }
        }

        function calcKVAFromIV(silentFail = false) {
            const v = getInput('voltage');
            const i = getInput('current');
            const phase = getPhase();
            
            if (v && i) {
                let kva, formula;
                if (phase === 3) {
                    kva = (Math.sqrt(3) * v * i) / 1000;
                    formula = 'kVA = (‚àö3 √ó V √ó I) / 1000';
                } else {
                    kva = (v * i) / 1000;
                    formula = 'kVA = (V √ó I) / 1000';
                }
                showResult('result-kva-iv', kva, 'kVA', formula, silentFail);
            } else {
                showResult('result-kva-iv', null, null, null, silentFail);
            }
        }

        function calcKVAFromKWpF(silentFail = false) {
            const kw = getInput('kw');
            const pf = getInput('pf');
            if (kw && pf) {
                const kva = kw / pf;
                showResult('result-kva-kwpf', kva, 'kVA', null, silentFail);
            } else {
                showResult('result-kva-kwpf', null, null, null, silentFail);
            }
        }

        function calcKVAFromHPEffpF(silentFail = false) {
            const hp = getInput('hp');
            const eff = getInput('eff');
            const pf = getInput('pf');
            if (hp && eff && pf) {
                const kva = (hp * 0.746) / ((eff / 100) * pf);
                showResult('result-kva-hpeffpf', kva, 'kVA', null, silentFail);
            } else {
                showResult('result-kva-hpeffpf', null, null, null, silentFail);
            }
        }

        function calcAFromKVA(silentFail = false) {
            const kva = getInput('kva');
            const v = getInput('voltage');
            const phase = getPhase();
            
            if (kva && v) {
                let a, formula;
                if (phase === 3) {
                    a = (kva * 1000) / (Math.sqrt(3) * v);
                    formula = 'A = (kVA √ó 1000) / (‚àö3 √ó V)';
                } else {
                    a = (kva * 1000) / v;
                    formula = 'A = (kVA √ó 1000) / V';
                }
                showResult('result-a-kva', a, 'A', formula, silentFail);
            } else {
                showResult('result-a-kva', null, null, null, silentFail);
            }
        }

        function calcAFromKW(silentFail = false) {
            const kw = getInput('kw');
            const v = getInput('voltage');
            const pf = getInput('pf');
            const phase = getPhase();
            
            if (kw && v && pf) {
                let a, formula;
                if (phase === 3) {
                    a = (kw * 1000) / (Math.sqrt(3) * v * pf);
                    formula = 'A = (kW √ó 1000) / (‚àö3 √ó V √ó pF)';
                } else {
                    a = (kw * 1000) / (v * pf);
                    formula = 'A = (kW √ó 1000) / (V √ó pF)';
                }
                showResult('result-a-kw', a, 'A', formula, silentFail);
            } else {
                showResult('result-a-kw', null, null, null, silentFail);
            }
        }

        function calcAFromHP(silentFail = false) {
            const hp = getInput('hp');
            const v = getInput('voltage');
            const eff = getInput('eff');
            const pf = getInput('pf');
            const phase = getPhase();
            
            if (hp && v && eff && pf) {
                let a, formula;
                if (phase === 3) {
                    a = (hp * 746) / (Math.sqrt(3) * v * (eff / 100) * pf);
                    formula = 'A = (HP √ó 746) / (‚àö3 √ó V √ó Eff √ó pF)';
                } else {
                    a = (hp * 746) / (v * (eff / 100) * pf);
                    formula = 'A = (HP √ó 746) / (V √ó Eff √ó pF)';
                }
                showResult('result-a-hp', a, 'A', formula, silentFail);
            } else {
                showResult('result-a-hp', null, null, null, silentFail);
            }
        }

        function calcAFromKVAR(silentFail = false) {
            const kvar = getInput('kvar');
            const v = getInput('voltage');
            const phase = getPhase();
            
            if (kvar && v) {
                let a, formula;
                if (phase === 3) {
                    a = (kvar * 1000) / (Math.sqrt(3) * v);
                    formula = 'A = (kVAR √ó 1000) / (‚àö3 √ó V)';
                } else {
                    a = (kvar * 1000) / v;
                    formula = 'A = (kVAR √ó 1000) / V';
                }
                showResult('result-a-kvar', a, 'A', formula, silentFail);
            } else {
                showResult('result-a-kvar', null, null, null, silentFail);
            }
        }

        function calcHPFromIVEffpF(silentFail = false) {
            const i = getInput('current');
            const v = getInput('voltage');
            const eff = getInput('eff');
            const pf = getInput('pf');
            const phase = getPhase();
            
            if (i && v && eff && pf) {
                let hp, formula;
                if (phase === 3) {
                    hp = (Math.sqrt(3) * v * i * pf * (eff / 100)) / 746;
                    formula = 'HP = (‚àö3 √ó V √ó I √ó pF √ó Eff) / 746';
                } else {
                    hp = (v * i * pf * (eff / 100)) / 746;
                    formula = 'HP = (V √ó I √ó pF √ó Eff) / 746';
                }
                showResult('result-hp-iveffpf', hp, 'HP', formula, silentFail);
            } else {
                showResult('result-hp-iveffpf', null, null, null, silentFail);
            }
        }

        function calcHPFromKVAEffpF(silentFail = false) {
            const kva = getInput('kva');
            const eff = getInput('eff');
            const pf = getInput('pf');
            
            if (kva && eff && pf) {
                const hp = (kva * 1000 * pf * (eff / 100)) / 746;
                const formula = 'HP = (kVA √ó 1000 √ó pF √ó Eff) / 746';
                showResult('result-hp-kvaeffpf', hp, 'HP', formula, silentFail);
            } else {
                showResult('result-hp-kvaeffpf', null, null, null, silentFail);
            }
        }

        function calcKVARFromKWKVA(silentFail = false) {
            const kw = getInput('kw');
            const kva = getInput('kva');
            if (kw && kva && kva >= kw) {
                const kvar = Math.sqrt(Math.pow(kva, 2) - Math.pow(kw, 2));
                showResult('result-kvar-kwkva', kvar, 'kVAR', null, silentFail);
            } else {
                showResult('result-kvar-kwkva', null, null, null, silentFail);
            }
        }

        // === G·ªåI H√ÄM T·∫¢I D·ªÆ LI·ªÜU KHI TRANG M·ªû ===
        // ƒê·∫∑t ·ªü cu·ªëi c√πng ƒë·ªÉ ƒë·∫£m b·∫£o t·∫•t c·∫£ h√†m ƒë√£ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a
        loadInputsFromLocalStorage();

    </script>
</body>
</html>
